<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ATLAS â€¢ AI Workspace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg-main: #020617;
      --bg-card: #020617;
      --bg-soft: #020617;
      --accent: #38bdf8;
      --border-soft: rgba(148, 163, 184, 0.3);
      --text-main: #e5e7eb;
      --text-soft: #94a3b8;
      --danger: #ef4444;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }
    .hidden { display: none !important; }
    .app-root {
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 12px;
    }
    .auth-wrapper {
      max-width: 420px;
      width: 100%;
      margin: auto;
    }
    .card {
      background: radial-gradient(circle at top left, #0b1120 0, #020617 60%);
      border: 1px solid rgba(148, 163, 184, 0.25);
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(16px);
    }
    .card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .logo {
      width: 38px;
      height: 38px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent), #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #020617;
      font-weight: 800;
      font-size: 20px;
      box-shadow: 0 0 25px rgba(56, 189, 248, 0.8);
    }
    .logo-title { font-size: 18px; font-weight: 700; }
    .logo-sub { font-size: 11px; color: var(--text-soft); }

    .auth-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; text-align: center; }
    .auth-sub { font-size: 11px; color: var(--text-soft); text-align: center; margin-bottom: 14px; }

    .field { margin-bottom: 10px; }
    .label { font-size: 11px; color: var(--text-soft); margin-bottom: 3px; display: block; }
    .input, .textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 12px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }
    .input:focus, .textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6);
      background: #020617;
    }
    .textarea { resize: none; min-height: 160px; }

    .btn {
      border: none;
      border-radius: 11px;
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: var(--accent);
      color: #020617;
      transition: background 0.15s, transform 0.1s, box-shadow 0.1s;
      box-shadow: 0 12px 26px rgba(56, 189, 248, 0.4);
    }
    .btn:hover {
      background: #22d3ee;
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(56, 189, 248, 0.6);
    }
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 10px 22px rgba(56, 189, 248, 0.5);
    }
    .btn-danger {
      background: var(--danger);
      color: #fef2f2;
      box-shadow: 0 10px 24px rgba(239, 68, 68, 0.6);
    }
    .btn-danger:hover { background: #f97373; }

    .auth-footer { margin-top: 10px; font-size: 11px; color: var(--text-soft); text-align: center; }
    .link { color: var(--accent); cursor: pointer; text-decoration: none; }
    .link:hover { text-decoration: underline; }

    /* APP LAYOUT */
    .app-shell {
      max-width: 1180px;
      width: 100%;
      display: grid;
      grid-template-columns: 220px minmax(0, 1fr);
      gap: 10px;
      background: radial-gradient(circle at top left, #020617 0, #000 70%);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 20px 60px rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }
    @media (max-width: 840px) {
      .app-shell { grid-template-columns: minmax(0, 1fr); }
      .sidebar { flex-direction: row; overflow-x: auto; }
      .sidebar-nav { display: flex; flex-direction: row; overflow-x: auto; }
      .sidebar-nav button { white-space: nowrap; }
    }

    .sidebar {
      background: linear-gradient(180deg, #020617 0, #020617 100%);
      border-inline-end: 1px solid rgba(148, 163, 184, 0.35);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }
    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 6px;
      flex: 1;
    }
    .nav-btn {
      border-radius: 9px;
      padding: 6px 10px;
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: 12px;
      text-align: right;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.15s, color 0.15s;
    }
    .nav-btn span { font-size: 10px; opacity: 0.8; }
    .nav-btn.active {
      background: var(--accent);
      color: #020617;
      font-weight: 600;
    }
    .nav-btn:hover:not(.active) {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
    }
    .sidebar-footer {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 10px;
      color: var(--text-soft);
    }

    .main-area { display: flex; flex-direction: column; min-height: 100%; }
    .topbar {
      padding: 8px 12px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: radial-gradient(circle at top, #020617 0, #020617 60%);
    }
    .topbar-title { font-size: 13px; font-weight: 600; }
    .topbar-sub { font-size: 10px; color: var(--text-soft); margin-top: 2px; }
    .topbar-user { font-size: 11px; color: var(--text-soft); text-align: left; }
    .pill {
      font-size: 10px;
      padding: 4px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--accent);
    }

    .main-content {
      padding: 10px 12px;
      flex: 1;
      overflow: auto;
      background: radial-gradient(circle at top, #020617 0, #020617 80%);
    }

    .grid { display: grid; gap: 10px; }
    .grid-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    @media (max-width: 900px) {
      .grid-3 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 640px) {
      .grid-3, .grid-2 { grid-template-columns: minmax(0, 1fr); }
    }

    .card-section {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.6);
    }
    .section-title { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
    .section-sub { font-size: 11px; color: var(--text-soft); margin-bottom: 6px; }

    .stat-main { font-size: 22px; font-weight: 700; margin-top: 4px; }
    .stat-label { font-size: 10px; color: var(--text-soft); margin-top: 1px; }

    .tag {
      display: inline-block;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      margin-inline: 1px;
      margin-top: 2px;
    }

    /* CHAT */
    .chat-layout {
      display: grid;
      gap: 10px;
      grid-template-columns: 210px minmax(0, 1fr);
      height: calc(100vh - 150px);
      max-height: 570px;
    }
    @media (max-width: 900px) {
      .chat-layout { grid-template-columns: minmax(0, 1fr); height: auto; max-height: none; }
    }
    .chat-modes { display: flex; flex-direction: column; gap: 6px; height: 100%; }
    .mode-btn {
      border-radius: 9px;
      border: none;
      padding: 6px 9px;
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      font-size: 11px;
      text-align: right;
      cursor: pointer;
      transition: background 0.15s, color 0.15s, transform 0.1s;
    }
    .mode-btn.active {
      background: var(--accent);
      color: #020617;
      font-weight: 600;
      transform: translateY(-1px);
    }
    .mode-btn:hover:not(.active) {
      background: rgba(15, 23, 42, 1);
      color: var(--text-main);
    }
    .chat-window { display: flex; flex-direction: column; height: 100%; }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      margin-bottom: 4px;
    }
    .bubble {
      max-width: 80%;
      border-radius: 16px;
      padding: 7px 9px;
      font-size: 11px;
      margin-bottom: 4px;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    .bubble.user {
      margin-left: auto;
      background: var(--accent);
      color: #020617;
      border-bottom-right-radius: 4px;
    }
    .bubble.assistant {
      margin-right: auto;
      background: rgba(15, 23, 42, 0.98);
      border-bottom-left-radius: 4px;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    .chat-form {
      display: flex;
      align-items: flex-end;
      gap: 6px;
      border-top: 1px solid rgba(148, 163, 184, 0.4);
      padding-top: 6px;
    }
    .chat-input {
      flex: 1;
      min-height: 32px;
      max-height: 80px;
      font-size: 11px;
    }

    /* NOTES */
    .notes-layout {
      display: grid;
      gap: 10px;
      grid-template-columns: 210px minmax(0, 1fr);
      height: calc(100vh - 150px);
      max-height: 570px;
    }
    @media (max-width: 900px) {
      .notes-layout { grid-template-columns: minmax(0, 1fr); height: auto; max-height: none; }
    }
    .notes-list { display: flex; flex-direction: column; height: 100%; gap: 6px; }
    .notes-scroll { flex: 1; overflow-y: auto; padding-right: 3px; }
    .note-item {
      width: 100%;
      text-align: right;
      padding: 6px 8px;
      border-radius: 9px;
      font-size: 11px;
      border: none;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-soft);
      transition: background 0.15s, color 0.15s;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .note-item.active {
      background: var(--accent);
      color: #020617;
      font-weight: 600;
    }
    .note-item:hover:not(.active) {
      background: rgba(15, 23, 42, 1);
      color: var(--text-main);
    }

    /* TOOLS & STUDENT CENTER */
    .two-cols {
      display: grid;
      gap: 8px;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    }
    @media (max-width: 800px) {
      .two-cols { grid-template-columns: minmax(0, 1fr); }
    }
    .pill-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }
    .pill-tab {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 4px 9px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      cursor: pointer;
    }
    .pill-tab.active {
      background: var(--accent);
      color: #020617;
      font-weight: 600;
      border-color: transparent;
    }

    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 999px;
    }
  </style>
</head>
<body>

<div id="app" class="app-root">

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ / Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="auth-view" class="auth-wrapper">
    <div class="card">
      <div class="card-header">
        <div class="logo">A</div>
        <div>
          <div class="logo-title">ATLAS</div>
          <div class="logo-sub">Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø¯Ø±Ø§Ø³Ø© ÙˆØ§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø­ÙŠØ§Ø©</div>
        </div>
      </div>

      <div id="auth-login">
        <div class="auth-title">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ Ø¥Ù„Ù‰ ATLAS</div>
        <div class="auth-sub">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„ØªÙƒÙ…Ù„ Ù†ÙˆØªØ§ØªÙƒ ÙˆÙ…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.</div>
        <div class="field">
          <label class="label">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="login-email" type="email" class="input" placeholder="your@email.com" />
        </div>
        <div class="field">
          <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø´ÙƒÙ„ÙŠØ© ÙÙ‚Ø·)</label>
          <input id="login-password" type="password" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
        <button class="btn" id="btn-login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <div class="auth-footer">
          Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ 
          <span class="link" id="go-signup">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
        </div>
      </div>

      <div id="auth-signup" class="hidden">
        <div class="auth-title">Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø¹Ù„Ù‰ ATLAS</div>
        <div class="auth-sub">Ù…Ø¬Ø§Ù†Ø§Ù‹ â€“ Ø¨Ø¯ÙˆÙ† Ø¨Ø·Ø§Ù‚Ø© Ø£Ùˆ Ø¯ÙØ¹. ÙÙ‚Ø· Ø¥ÙŠÙ…ÙŠÙ„Ùƒ.</div>
        <div class="field">
          <label class="label">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="signup-email" type="email" class="input" placeholder="your@email.com" />
        </div>
        <div class="field">
          <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·)</label>
          <input id="signup-password" type="password" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
        <button class="btn" id="btn-signup">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <div class="auth-footer">
          Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŸ 
          <span class="link" id="go-login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
        </div>
      </div>

      <div class="auth-footer" style="margin-top: 8px;">
        ØµÙÙ†Ø¹ Ø¨Ø­ÙØ¨ Ø¨ÙˆØ§Ø³Ø·Ø© <span style="color: var(--accent); font-weight: 600;">Mahmoud</span> â€¢ Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
      </div>
    </div>
  </div>

  <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="app-view" class="app-shell hidden">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">A</div>
        <div>
          <div class="logo-title" style="font-size: 15px;">ATLAS</div>
          <div class="logo-sub">AI Workspace</div>
        </div>
      </div>
      <div class="sidebar-nav">
        <button class="nav-btn active" data-page-btn="dashboard">
          <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
          <span>Overview</span>
        </button>
        <button class="nav-btn" data-page-btn="chat">
          <span>Ù…Ø­Ø§Ø¯Ø«Ø© AI</span>
          <span>Chat</span>
        </button>
        <button class="nav-btn" data-page-btn="notes">
          <span>Ø§Ù„Ù†ÙˆØªØ§Øª</span>
          <span>Notes</span>
        </button>
        <button class="nav-btn" data-page-btn="tools">
          <span>Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</span>
          <span>Tools</span>
        </button>
        <button class="nav-btn" data-page-btn="students">
          <span>Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ù„Ø§Ø¨</span>
          <span>Study</span>
        </button>
      </div>
      <div class="sidebar-footer">
        <div>ÙˆØ¶Ø¹: <span class="pill">Gemini â€¢ Online</span></div>
        <button id="btn-logout" class="btn btn-danger" style="width: 100%; margin-top: 3px; padding-block: 5px;">
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </button>
      </div>
    </aside>

    <!-- Main -->
    <div class="main-area">
      <header class="topbar">
        <div>
          <div class="topbar-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ATLAS</div>
          <div class="topbar-sub">
            Ù…Ø³Ø§Ø­Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø·Ù„Ø§Ø¨ØŒ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†ØŒ ÙˆØ£ØµØ­Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„â€¦ ÙƒÙ„Ù‡Ù… ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.
          </div>
        </div>
        <div class="topbar-user">
          <div id="topbar-email"></div>
          <div style="margin-top: 2px;">
            <span class="pill">Gemini â€¢ Ø¹Ø±Ø¨ÙŠ / Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</span>
          </div>
        </div>
      </header>

      <main class="main-content">
        <!-- Dashboard -->
        <section id="page-dashboard">
          <div class="grid grid-3" style="margin-bottom: 10px;">
            <div class="card-section">
              <div class="section-title">Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
              <div class="section-sub">ÙƒÙ… Ù…Ø±Ø© Ø§Ø³ØªØ®Ø¯Ù…Øª ATLAS Ù„Ù„ØªÙÙƒÙŠØ± ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©.</div>
              <div class="stat-main" id="dash-ai-sessions">0</div>
              <div class="stat-label">Ø§Ù„ÙŠÙˆÙ… (Ù…Ø­Ø³ÙˆØ¨ Ù…Ø­Ù„ÙŠØ§Ù‹)</div>
            </div>
            <div class="card-section">
              <div class="section-title">Ø§Ù„Ù†ÙˆØªØ§Øª Ø§Ù„Ù…Ø®Ø²Ù‘Ù†Ø©</div>
              <div class="section-sub">Ø£ÙÙƒØ§Ø±ÙƒØŒ Ù…Ù‡Ø§Ù…ÙƒØŒ ÙˆØ®Ø·Ø·Ùƒ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.</div>
              <div class="stat-main" id="dash-notes-count">0</div>
              <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ</div>
            </div>
            <div class="card-section">
              <div class="section-title">Ø¥Ù…ÙƒØ§Ù†Ø§Øª ATLAS</div>
              <div class="section-sub">Ø·Ù„Ø§Ø¨ØŒ Ø£Ø¹Ù…Ø§Ù„ØŒ Ù…Ø­ØªÙˆÙ‰ØŒ Ø¨Ø±Ù…Ø¬Ø©ØŒ Ø­ÙŠØ§Ø© Ø´Ø®ØµÙŠØ©.</div>
              <div class="stat-main">âˆ</div>
              <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø®Ø¯Ù…ØªÙ‡Ø§</div>
            </div>
          </div>

          <div class="grid grid-2">
            <div class="card-section">
              <div class="section-title">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§</div>
              <div class="section-sub">Ù†Ù…Ø§Ø°Ø¬ Ø¬Ø§Ù‡Ø²Ø© ØªØ³Ø§Ø¹Ø¯Ùƒ Ø¨Ø³Ø±Ø¹Ø©.</div>
              <ul style="font-size: 11px; color: var(--text-main); line-height: 1.5; list-style: none; padding-right: 10px;">
                <li>â€¢ ÙƒØªØ§Ø¨Ø© Ø¥ÙŠÙ…ÙŠÙ„ Ø±Ø³Ù…ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.</li>
                <li>â€¢ ØªÙ„Ø®ÙŠØµ Ù…Ù‚Ø§Ù„Ø© Ø·ÙˆÙŠÙ„Ø© Ø£Ùˆ Ø¨Ø­Ø«.</li>
                <li>â€¢ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¯Ø±Ø§Ø³Ø© Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª (ØªÙˆØ¬ÙŠÙ‡ÙŠ / Ø¬Ø§Ù…Ø¹Ø©).</li>
                <li>â€¢ ØªÙˆÙ„ÙŠØ¯ Ø£ÙÙƒØ§Ø± Ù„Ù…Ø­ØªÙˆÙ‰ TikTok / YouTube.</li>
                <li>â€¢ Ø·Ù„Ø¨ Ø´Ø±Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø£Ùˆ Ø­Ù„ Ù…Ø³Ø£Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ§Øª.</li>
              </ul>
            </div>
            <div class="card-section">
              <div class="section-title">ØªØ¯ÙÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ</div>
              <div class="section-sub">ÙƒÙŠÙ ØªØ³ØªØºÙ„ ATLAS Ø¨Ø£ÙØ¶Ù„ ØµÙˆØ±Ø©.</div>
              <p style="font-size: 11px; color: var(--text-main); line-height: 1.6;">
                1. Ø§Ø³Ø£Ù„ ÙÙŠ <span class="tag">Ù…Ø­Ø§Ø¯Ø«Ø© AI</span> Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙÙƒØ±Ø© Ø£Ùˆ Ø§Ù„Ø­Ù„.<br />
                2. Ø®Ø²Ù‘Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ <span class="tag">Ø§Ù„Ù†ÙˆØªØ§Øª</span> Ù…Ø¹ ØªÙ†Ø¸ÙŠÙ… Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø£Ùˆ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹.<br />
                3. Ø§Ø³ØªØ®Ø¯Ù… <span class="tag">Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</span> Ù„Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ©ØŒ ØªÙ„Ø®ÙŠØµØŒ Ø£Ùˆ ØªØ±Ø¬Ù…Ø©.<br />
                4. Ø¹Ø¯ Ø¥Ù„Ù‰ <span class="tag">Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ù„Ø§Ø¨</span> Ù„ØµÙ†Ø§Ø¹Ø© Ù…Ù„Ø®ØµØ§Øª ÙˆØ®Ø·Ø· Ø¯Ø±Ø§Ø³Ø© Ø®Ø§ØµØ© Ø¨Ùƒ.<br />
              </p>
            </div>
          </div>
        </section>

        <!-- Chat -->
        <section id="page-chat" class="hidden">
          <div class="chat-layout card-section">
            <aside class="chat-modes">
              <div>
                <div class="section-title">Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ Ø§Ù„Ø°ÙƒÙŠØ©</div>
                <div class="section-sub">
                  Ø§Ø®ØªØ± ÙˆØ¶Ø¹ ÙŠØ³Ø§Ø¹Ø¯ ATLAS ÙŠÙÙ‡Ù… Ù†ÙŠØªÙƒ Ø£Ø³Ø±Ø¹.
                </div>
              </div>
              <div id="chat-modes-container" style="flex:1; overflow-y:auto; padding-right:2px; margin-top:4px;"></div>
              <div style="font-size:10px; color:var(--text-soft); border-top:1px solid rgba(148,163,184,.35); padding-top:4px; margin-top:4px;">
                Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:
                <span id="chat-current-mode" style="color:var(--accent); font-weight:600;">Ø·Ø§Ù„Ø¨</span>
              </div>
            </aside>

            <section class="chat-window">
              <div class="chat-messages" id="chat-messages"></div>
              <form class="chat-form" id="chat-form">
                <textarea
                  id="chat-input"
                  class="textarea chat-input"
                  placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø·Ù„Ø¨Ùƒ Ù‡Ù†Ø§â€¦ Ù…Ø«Ø§Ù„: Ø§Ø´Ø±Ø­ Ù„ÙŠ Ù‚Ø§Ø¹Ø¯Ø© Passive Voice Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠ 2006ØŒ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø¥ÙŠÙ…ÙŠÙ„ Ù„Ø´Ø±ÙƒØ© Ø¨Ø®ØµÙˆØµ ÙˆØ¸ÙŠÙØ©."
                ></textarea>
                <button type="submit" class="btn" style="flex-shrink:0; padding-inline:10px;">Ø¥Ø±Ø³Ø§Ù„</button>
              </form>
              <div id="chat-status" style="font-size:10px; color:var(--text-soft); margin-top:2px;"></div>
            </section>
          </div>
        </section>

        <!-- Notes -->
        <section id="page-notes" class="hidden">
          <div class="notes-layout card-section">
            <aside class="notes-list">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
                <div class="section-title">Ø§Ù„Ù†ÙˆØªØ§Øª</div>
                <button id="btn-add-note" class="btn" style="padding-block:4px; font-size:11px;">+ Ù†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
              </div>
              <div class="section-sub">
                Ø®Ø²Ù† ÙƒÙ„ Ø£ÙÙƒØ§Ø±ÙƒØŒ Ù…Ù‡Ø§Ù…Ùƒ ÙˆØ®Ø·Ø·Ùƒ Ù‡Ù†Ø§. ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.
              </div>
              <div id="notes-list" class="notes-scroll"></div>
              <div style="font-size:10px; color:var(--text-soft); border-top:1px solid rgba(148,163,184,.35); padding-top:4px;">
                ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ÙˆØªØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ <span class="tag">LocalStorage</span>.
              </div>
            </aside>

            <section class="card-section" style="background:rgba(15,23,42,.97);">
              <input id="note-title" class="input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†ÙˆØªØ© (Ù…Ø«Ø§Ù„: Ø®Ø·Ø© Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)" style="margin-bottom:5px; font-size:12px; font-weight:600;" />
              <textarea id="note-content" class="textarea" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„ Ø´ÙŠØ¡ ØªØ±ÙŠØ¯ ØªØ°ÙƒØ±Ù‡â€¦ Ø£ÙÙƒØ§Ø±ØŒ Ù…Ù‡Ø§Ù…ØŒ Ø±ÙˆØ§Ø¨Ø·ØŒ Ø®Ø·Ø·ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù† Ù…Ø­Ø§Ø¯Ø«Ø© ATLAS."></textarea>
            </section>
          </div>
        </section>

        <!-- Tools -->
        <section id="page-tools" class="hidden">
          <div class="card-section">
            <div class="section-title">Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</div>
            <div class="section-sub">
              Ø£Ø¯ÙˆØ§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„ØªÙ„Ø®ÙŠØµØŒ Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ©ØŒ ØªØ±Ø¬Ù…Ø©ØŒ ØªÙˆÙ„ÙŠØ¯ Ø£ÙÙƒØ§Ø±ØŒ ÙˆØªØ¬Ù‡ÙŠØ² Prompt Ù„Ù„ØµÙˆØ±ØŒ Ù…Ø¹ Gemini.
            </div>
            <div class="pill-tabs" id="tools-tabs"></div>

            <div class="two-cols">
              <div>
                <label class="label">Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ÙÙƒØ±Ø©:</label>
                <textarea id="tools-input" class="textarea" placeholder="Ø£Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø·Ù„Ø¨Ùƒâ€¦"></textarea>
              </div>
              <div>
                <label class="label">Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ù…Ù† Gemini):</label>
                <textarea id="tools-output" class="textarea" readonly placeholder="Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§â€¦"></textarea>
              </div>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:6px;">
              <div style="font-size:10px; color:var(--text-soft);">
                ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ <span class="tag">Gemini 1.5 Flash</span> Ù„ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯ÙˆØ§Øª.
              </div>
              <button id="btn-tools-run" class="btn" style="padding-inline:14px; font-size:11px;">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
            </div>
          </div>
        </section>

        <!-- Student Center -->
        <section id="page-students" class="hidden">
          <div class="card-section">
            <div class="section-title">Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ù„Ø§Ø¨</div>
            <div class="section-sub">
              Ù…Ø³Ø§Ø¹Ø¯Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠØŒ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ ÙˆØ§Ù„Ù…Ø¯Ø§Ø±Ø³: Ø­Ù„ Ø£Ø³Ø¦Ù„Ø©ØŒ Ù…Ù„Ø®ØµØ§ØªØŒ Ø®Ø·Ø· Ø¯Ø±Ø§Ø³Ø©ØŒ ÙˆØ§Ù…ØªØ­Ø§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Gemini.
            </div>

            <div class="pill-tabs" id="student-tabs"></div>

            <div class="two-cols">
              <div>
                <label class="label">Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ / Ø§Ù„Ø¯Ø±Ø³ / Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
                <textarea id="student-input" class="textarea" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø®Øµ Ù„ÙŠ ÙˆØ­Ø¯Ø© Passive Voice Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠ 2006ØŒ Ø£Ùˆ Ø§Ø¹Ù…Ù„ Ù„ÙŠ Ø®Ø·Ø© Ø¯Ø±Ø§Ø³Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª."></textarea>
              </div>
              <div>
                <label class="label">Ø§Ù„Ù†Ø§ØªØ¬:</label>
                <textarea id="student-output" class="textarea" readonly placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©ØŒ Ø§Ù„Ù…Ù„Ø®ØµØŒ Ø£Ùˆ Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§â€¦"></textarea>
              </div>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:6px;">
              <div style="font-size:10px; color:var(--text-soft);">
                ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø§Øª Ù„ØªÙƒÙˆÙ† Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø·Ù„Ø§Ø¨ Ù…Ù†Ø·Ù‚Ø© Ù…Ø«Ù„ Ø§Ù„Ø£Ø±Ø¯Ù† ÙˆØ§Ù„Ø¨Ù„Ø¯Ø§Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.
              </div>
              <button id="btn-student-run" class="btn" style="padding-inline:14px; font-size:11px;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø§ØªØ¬</button>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

</div>

<script>
  // =============== Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ (Flask) ===============
  // Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ ÙÙŠÙ‡ /api/gemini ÙÙŠ app.py
  const GEMINI_PROXY = "/api/gemini";

  async function callGemini(promptText) {
    const res = await fetch(GEMINI_PROXY, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: promptText })
    });

    if (!res.ok) {
      const txt = await res.text();
      console.error("Gemini proxy error:", txt);
      throw new Error("Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ / Gemini: " + res.status);
    }

    const data = await res.json();
    const text =
      data.candidates &&
      data.candidates[0] &&
      data.candidates[0].content &&
      data.candidates[0].content.parts &&
      data.candidates[0].content.parts[0] &&
      data.candidates[0].content.parts[0].text;

    return text || "Ù„Ù… Ø£Ø³ØªØ·Ø¹ ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ù…Ù†Ø§Ø³Ø¨ Ù…Ù† Gemini.";
  }

  // --------- ØªØ®Ø²ÙŠÙ† Ø¨Ø³ÙŠØ· ----------
  const STORAGE_USER = "atlas_user";
  const STORAGE_NOTES = "atlas_notes";
  const STORAGE_AI_SESSIONS = "atlas_ai_sessions";

  function saveUser(email) {
    localStorage.setItem(STORAGE_USER, JSON.stringify({ email }));
  }
  function getUser() {
    const raw = localStorage.getItem(STORAGE_USER);
    if (!raw) return null;
    try { return JSON.parse(raw); } catch { return null; }
  }
  function clearUser() {
    localStorage.removeItem(STORAGE_USER);
  }

  // --------- Auth Logic ----------
  const authView = document.getElementById("auth-view");
  const appView = document.getElementById("app-view");

  const authLogin = document.getElementById("auth-login");
  const authSignup = document.getElementById("auth-signup");
  const goSignup = document.getElementById("go-signup");
  const goLogin = document.getElementById("go-login");

  const loginEmail = document.getElementById("login-email");
  const loginPassword = document.getElementById("login-password");
  const btnLogin = document.getElementById("btn-login");

  const signupEmail = document.getElementById("signup-email");
  const signupPassword = document.getElementById("signup-password");
  const btnSignup = document.getElementById("btn-signup");

  const topbarEmail = document.getElementById("topbar-email");
  const btnLogout = document.getElementById("btn-logout");

  goSignup.addEventListener("click", () => {
    authLogin.classList.add("hidden");
    authSignup.classList.remove("hidden");
  });
  goLogin.addEventListener("click", () => {
    authSignup.classList.add("hidden");
    authLogin.classList.remove("hidden");
  });

  btnLogin.addEventListener("click", () => {
    const email = loginEmail.value.trim();
    if (!email) {
      alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
      return;
    }
    saveUser(email);
    showApp();
  });

  btnSignup.addEventListener("click", () => {
    const email = signupEmail.value.trim();
    if (!email) {
      alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
      return;
    }
    saveUser(email);
    showApp();
  });

  btnLogout.addEventListener("click", () => {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
      clearUser();
      location.reload();
    }
  });

  function showApp() {
    const user = getUser();
    if (!user) return;
    authView.classList.add("hidden");
    appView.classList.remove("hidden");
    topbarEmail.textContent = user.email || "";
    updateDashboardStats();
    loadNotes();
    initChat();
  }

  // --------- Navigation ----------
  const pageIds = ["dashboard", "chat", "notes", "tools", "students"];
  const navButtons = document.querySelectorAll("[data-page-btn]");

  navButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const target = btn.getAttribute("data-page-btn");
      pageIds.forEach(id => {
        document.getElementById("page-" + id).classList.toggle("hidden", id !== target);
      });
      navButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    });
  });

  // --------- Dashboard stats ----------
  const dashAi = document.getElementById("dash-ai-sessions");
  const dashNotes = document.getElementById("dash-notes-count");

  function updateDashboardStats() {
    const ai = Number(localStorage.getItem(STORAGE_AI_SESSIONS) || "0");
    dashAi.textContent = ai;

    const raw = localStorage.getItem(STORAGE_NOTES);
    let list = [];
    if (raw) {
      try { list = JSON.parse(raw); } catch {}
    }
    dashNotes.textContent = list.length;
  }

  // --------- Chat ----------
  const chatModes = [
    "Ø·Ø§Ù„Ø¨",
    "Ù…ÙˆØ¸Ù",
    "ÙƒØ§ØªØ¨ Ù…Ø­ØªÙˆÙ‰",
    "Ù…Ø¨Ø±Ù…Ø¬",
    "Ù…ØªØ±Ø¬Ù…",
    "Ø¨Ø§Ø­Ø«",
    "Ù…Ø§Ù„ÙŠØ§Øª / ØªØ¯Ø§ÙˆÙ„"
  ];
  let chatCurrentMode = "Ø·Ø§Ù„Ø¨";
  let chatMessagesArr = [
    {
      role: "assistant",
      content: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ATLAS Chat ğŸ‘‹\nØ£Ù†Ø§ Ù…ØªØµÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¨Ù†Ù…ÙˆØ°Ø¬ Gemini Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯.\nØ§Ø®ØªØ± ÙˆØ¶Ø¹Ùƒ (Ø·Ø§Ù„Ø¨ØŒ Ù…ÙˆØ¸ÙØŒ ØµØ§Ø­Ø¨ Ù…Ø­ØªÙˆÙ‰...) Ø«Ù… Ø§Ø³Ø£Ù„ Ù…Ø§ ØªØ±ÙŠØ¯ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ."
    }
  ];
  const chatModesContainer = document.getElementById("chat-modes-container");
  const chatCurrentModeLabel = document.getElementById("chat-current-mode");
  const chatMessagesDiv = document.getElementById("chat-messages");
  const chatForm = document.getElementById("chat-form");
  const chatInput = document.getElementById("chat-input");
  const chatStatus = document.getElementById("chat-status");

  function initChat() {
    chatModesContainer.innerHTML = "";
    chatModes.forEach(mode => {
      const btn = document.createElement("button");
      btn.textContent = mode;
      btn.className = "mode-btn" + (mode === chatCurrentMode ? " active" : "");
      btn.addEventListener("click", () => {
        chatCurrentMode = mode;
        chatCurrentModeLabel.textContent = mode;
        [...chatModesContainer.children].forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
      chatModesContainer.appendChild(btn);
    });
    renderChatMessages();
  }

  function renderChatMessages() {
    chatMessagesDiv.innerHTML = "";
    chatMessagesArr.forEach(msg => {
      const div = document.createElement("div");
      div.className = "bubble " + (msg.role === "user" ? "user" : "assistant");
      div.textContent = msg.content;
      chatMessagesDiv.appendChild(div);
    });
    chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
  }

  chatForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text = chatInput.value.trim();
    if (!text) return;
    chatMessagesArr.push({ role: "user", content: text });
    chatInput.value = "";
    renderChatMessages();
    chatStatus.textContent = "ATLAS (Gemini) ÙŠÙÙƒØ±â€¦";

    const current = Number(localStorage.getItem(STORAGE_AI_SESSIONS) || "0");
    localStorage.setItem(STORAGE_AI_SESSIONS, String(current + 1));
    updateDashboardStats();

    try {
      const prompt =
        "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒØ§Ø¡ Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ Ù…Ù†ØµØ© Ø§Ø³Ù…Ù‡Ø§ ATLAS. " +
        "ØªÙƒÙ„Ù‘Ù… Ø¨Ù„ØºØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø§Ù„Ù…Ø¨Ø³Ø·Ø©ØŒ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„Ùˆ ÙƒØªØ¨ Ø¨Ù‡Ø§). " +
        "ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ: " + chatCurrentMode + ".\n\n" +
        "Ø³Ø§Ø¹Ø¯Ù‡ Ø¨Ø£ÙØ¶Ù„ Ø´ÙƒÙ„ Ù…Ù…ÙƒÙ†ØŒ Ù…Ø¹ ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.\n\n" +
        "Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\n" + text;

      const answer = await callGemini(prompt);
      chatMessagesArr.push({ role: "assistant", content: answer });
    } catch (err) {
      console.error(err);
      chatMessagesArr.push({
        role: "assistant",
        content: "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø´ØºØ§Ù„ ÙˆÙ…ÙØªØ§Ø­ GEMINI_API_KEY Ù…Ø¶Ø¨ÙˆØ· Ù‡Ù†Ø§Ùƒ."
      });
    } finally {
      renderChatMessages();
      chatStatus.textContent = "";
    }
  });

  // --------- Notes ----------
  const notesListDiv = document.getElementById("notes-list");
  const noteTitleInput = document.getElementById("note-title");
  const noteContentTextarea = document.getElementById("note-content");
  const btnAddNote = document.getElementById("btn-add-note");
  let notes = [];
  let activeNoteId = null;

  function loadNotes() {
    const raw = localStorage.getItem(STORAGE_NOTES);
    if (raw) {
      try { notes = JSON.parse(raw); } catch { notes = []; }
    } else {
      notes = [];
    }
    if (notes.length === 0) {
      const first = {
        id: Date.now().toString(),
        title: "Ø£ÙˆÙ„ Ù†ÙˆØªØ© Ù„Ùƒ ÙÙŠ ATLAS",
        content: "Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø®Ø·ØªÙƒØŒ Ø£ÙÙƒØ§Ø±ÙƒØŒ Ù…Ù‡Ø§Ù…ÙƒØŒ Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù† Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ."
      };
      notes.push(first);
      activeNoteId = first.id;
      saveNotes();
    } else if (!activeNoteId) {
      activeNoteId = notes[0].id;
    }
    renderNotesList();
    renderActiveNote();
    updateDashboardStats();
  }

  function saveNotes() {
    localStorage.setItem(STORAGE_NOTES, JSON.stringify(notes));
    updateDashboardStats();
  }

  function renderNotesList() {
    notesListDiv.innerHTML = "";
    if (notes.length === 0) {
      const p = document.createElement("p");
      p.style.fontSize = "10px";
      p.style.color = "var(--text-soft)";
      p.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØªØ§Øª Ø¨Ø¹Ø¯. Ø£Ù†Ø´Ø¦ Ù†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©.";
      notesListDiv.appendChild(p);
      return;
    }
    notes.forEach(note => {
      const btn = document.createElement("button");
      btn.className = "note-item" + (note.id === activeNoteId ? " active" : "");
      btn.textContent = note.title || "Ù†ÙˆØªØ© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
      btn.addEventListener("click", () => {
        activeNoteId = note.id;
        renderNotesList();
        renderActiveNote();
      });
      notesListDiv.appendChild(btn);
    });
  }

  function renderActiveNote() {
    const note = notes.find(n => n.id === activeNoteId);
    if (!note) {
      noteTitleInput.value = "";
      noteContentTextarea.value = "";
      return;
    }
    noteTitleInput.value = note.title;
    noteContentTextarea.value = note.content;
  }

  btnAddNote.addEventListener("click", () => {
    const newNote = {
      id: Date.now().toString(),
      title: "Ù†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©",
      content: ""
    };
    notes.unshift(newNote);
    activeNoteId = newNote.id;
    saveNotes();
    renderNotesList();
    renderActiveNote();
  });

  noteTitleInput.addEventListener("input", () => {
    const note = notes.find(n => n.id === activeNoteId);
    if (!note) return;
    note.title = noteTitleInput.value;
    saveNotes();
    renderNotesList();
  });

  noteContentTextarea.addEventListener("input", () => {
    const note = notes.find(n => n.id === activeNoteId);
    if (!note) return;
    note.content = noteContentTextarea.value;
    saveNotes();
  });

  // --------- Tools ----------
  const toolsTabsDiv = document.getElementById("tools-tabs");
  const toolsInput = document.getElementById("tools-input");
  const toolsOutput = document.getElementById("tools-output");
  const btnToolsRun = document.getElementById("btn-tools-run");

  const toolsList = [
    { id: "summary", label: "ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù†ØµÙˆØµ" },
    { id: "rephrase", label: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙŠØ§ØºØ©" },
    { id: "translate", label: "Ø§Ù„ØªØ±Ø¬Ù…Ø©" },
    { id: "ideas", label: "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙÙƒØ§Ø±" },
    { id: "image", label: "Prompt Ù„Ù„ØµÙˆØ±" }
  ];
  let activeToolId = "summary";

  function initTools() {
    toolsTabsDiv.innerHTML = "";
    toolsList.forEach(tool => {
      const btn = document.createElement("button");
      btn.className = "pill-tab" + (tool.id === activeToolId ? " active" : "");
      btn.textContent = tool.label;
      btn.addEventListener("click", () => {
        activeToolId = tool.id;
        [...toolsTabsDiv.children].forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
      toolsTabsDiv.appendChild(btn);
    });
  }

  btnToolsRun.addEventListener("click", async () => {
    const input = toolsInput.value.trim();
    if (!input) {
      alert("Ø£Ù„ØµÙ‚ Ø£Ùˆ Ø§ÙƒØªØ¨ Ù†ØµØ§Ù‹ Ù„ØªØ¬Ø±Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø©.");
      return;
    }
    toolsOutput.value = "ATLAS (Gemini) ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†â€¦";
    try {
      let instruction = "";
      switch (activeToolId) {
        case "summary":
          instruction =
            "Ù„Ø®Ù‘Øµ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø§Ù„Ù…Ø¨Ø³Ø·Ø© ÙÙŠ Ù†Ù‚Ø§Ø· ÙˆØ§Ø¶Ø­Ø©ØŒ Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù…Ù‡Ù…Ø©:";
          break;
        case "rephrase":
          instruction =
            "Ø£Ø¹Ø¯ ØµÙŠØ§ØºØ© Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø£ÙØ¶Ù„ ÙˆØ£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹ØŒ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù†Ù‰:";
          break;
        case "translate":
          instruction =
            "ØªØ±Ø¬Ù… Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ ØªØ±Ø¬Ù…Ø© Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø¥Ø°Ø§ Ù‡Ùˆ Ø¹Ø±Ø¨ÙŠ ÙØªØ±Ø¬Ù…Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©ØŒ ÙˆØ¥Ø°Ø§ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙØªØ±Ø¬Ù…Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:";
          break;
        case "ideas":
          instruction =
            "Ù‚Ø¯Ù‘Ù… Ø£ÙÙƒØ§Ø±Ø§Ù‹ Ø¹Ù…Ù„ÙŠØ© (Ù‚ÙˆØ§Ø¦Ù… Ø¨Ù†Ù‚Ø§Ø·) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ. Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø£Ù…Ø«Ù„Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚:";
          break;
        case "image":
          instruction =
            "Ø§ÙƒØªØ¨ Ù„ÙŠ Prompt Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„ØµÙˆØ±Ø© ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø¹ Ù…ÙˆÙ„Ø¯ ØµÙˆØ± Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØµÙ Ø§Ù„ØªØ§Ù„ÙŠ:";
          break;
      }
      const prompt = instruction + "\n\n" + input;
      const result = await callGemini(prompt);
      toolsOutput.value = result;
    } catch (err) {
      console.error(err);
      toolsOutput.value = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø´ØºØ§Ù„ ÙˆÙ…ÙØªØ§Ø­ GEMINI_API_KEY Ù…Ø¶Ø¨ÙˆØ· Ù‡Ù†Ø§Ùƒ.";
    }
  });

  // --------- Student Center ----------
  const studentTabsDiv = document.getElementById("student-tabs");
  const studentInput = document.getElementById("student-input");
  const studentOutput = document.getElementById("student-output");
  const btnStudentRun = document.getElementById("btn-student-run");

  const studentTabs = [
    { id: "qna", label: "Ø­Ù„ Ø£Ø³Ø¦Ù„Ø© / Ø´Ø±Ø­" },
    { id: "summaries", label: "Ù…Ù„Ø®ØµØ§Øª" },
    { id: "plans", label: "Ø®Ø·Ø· Ø¯Ø±Ø§Ø³Ø©" },
    { id: "exams", label: "Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©" }
  ];
  let activeStudentTab = "qna";

  function initStudentCenter() {
    studentTabsDiv.innerHTML = "";
    studentTabs.forEach(tab => {
      const btn = document.createElement("button");
      btn.className = "pill-tab" + (tab.id === activeStudentTab ? " active" : "");
      btn.textContent = tab.label;
      btn.addEventListener("click", () => {
        activeStudentTab = tab.id;
        [...studentTabsDiv.children].forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
      studentTabsDiv.appendChild(btn);
    });
  }

  btnStudentRun.addEventListener("click", async () => {
    const text = studentInput.value.trim();
    if (!text) {
      alert("Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø¯Ø±Ø³ Ø£Ùˆ ÙˆØ­Ø¯Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ø§ØªØ¬.");
      return;
    }
    studentOutput.value = "ATLAS (Gemini) ÙŠØ­Ø¶Ù‘Ø± Ù„Ùƒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©â€¦";
    try {
      let instruction = "";
      switch (activeStudentTab) {
        case "qna":
          instruction =
            "Ø£Ù†Øª Ù…Ø¹Ù„Ù‘Ù… Ù„Ø·ÙŠÙ ÙŠØ´Ø±Ø­ Ù„Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø§Ù„Ù…Ø¨Ø³Ø·Ø©. Ø§Ø´Ø±Ø­ Ø£Ùˆ Ø­Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© ÙˆØ¨Ø´ÙƒÙ„ Ø³Ù‡Ù„ Ø¬Ø¯Ø§Ù‹:";
          break;
        case "summaries":
          instruction =
            "Ù„Ø®Ù‘Øµ Ø§Ù„ÙˆØ­Ø¯Ø© / Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ø·Ù„Ø§Ø¨ Ù…Ø±Ø­Ù„Ø© Ù…Ø«Ù„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ÙŠ Ø£Ùˆ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ Ù…Ø¹ Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ùˆ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ù†Ù‚Ø§Ø·:";
          break;
        case "plans":
          instruction =
            "Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© Ø¯Ø±Ø§Ø³Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ø£Ùˆ Ø´Ù‡Ø±ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠØŒ Ù…Ø¹ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ ÙˆÙˆÙ‚Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:";
          break;
        case "exams":
          instruction =
            "Ø£Ù†Ø´Ø¦ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù…ØªØ­Ø§Ù† ØªØ¯Ø±ÙŠØ¨ÙŠ (Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ØŒ ØµØ­/Ø®Ø·Ø£ØŒ ÙˆØ£Ø³Ø¦Ù„Ø© Ù…Ù‚Ø§Ù„ÙŠØ© Ù‚ØµÙŠØ±Ø©) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„ØªØ§Ù„ÙŠ:";
          break;
      }
      const prompt = instruction + "\n\n" + text;
      const result = await callGemini(prompt);
      studentOutput.value = result;
    } catch (err) {
      console.error(err);
      studentOutput.value = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø´ØºØ§Ù„ ÙˆÙ…ÙØªØ§Ø­ GEMINI_API_KEY Ù…Ø¶Ø¨ÙˆØ· Ù‡Ù†Ø§Ùƒ.";
    }
  });

  // --------- Initial load ----------
  window.addEventListener("load", () => {
    const user = getUser();
    initTools();
    initStudentCenter();
    if (user) {
      showApp();
    } else {
      authView.classList.remove("hidden");
    }
  });
</script>

</body>
</html>
